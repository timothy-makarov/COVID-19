---
title: 'COVID-19'
author: 'Москва, Россия'
date: 'Апрель 2020'
output:
  pdf_document:
    latex_engine: pdflatex
header-includes:
  - \usepackage[russian]{babel}
---

```{r setup,include=FALSE}
rm(list = ls())

library(knitr)
library(dplyr)
library(ggplot2)
library(scales)

opts_chunk$set(echo = FALSE, cache = FALSE, warning = FALSE, message = FALSE, comment = '')

source('COVID-19.R')
```

# Инфицированные

```{r charts_infected_growth,fig.align='center',dev='cairo_pdf'}
ggplot(df0) +
  geom_col(aes(date, infected_growth), size = 0.75) +
  geom_point(aes(date, infected_growth), color = 'brown', size = 0.75) +
  geom_line(aes(date, infected_growth_lm0), color = 'brown', size = 0.25, linetype = 'dashed') +
  scale_x_date(breaks = pretty_breaks(10)) +
  labs(x = '', y = '') +
  ggtitle('Ежедневный прирост инфицированных') +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r charts_infected,fig.align='center',dev='cairo_pdf'}
ggplot(df0) +
  geom_col(aes(date, infected), size = 0.75) +
  geom_point(aes(date, infected), color = 'brown', size = 0.75) +
  geom_line(
    aes(date, infected_lm0),
    color = 'brown',
    size = 0.25,
    linetype = 'dashed'
  ) +
  scale_x_date(breaks = pretty_breaks(10)) +
  labs(x = '', y = '') +
  ggtitle('Общее число инфицированных') +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r charts_infected_rate,fig.align='center',dev='cairo_pdf'}
ggplot(df0) +
  geom_col(aes(date, infected_rate), size = 0.75) +
  geom_point(aes(date, infected_rate), color = 'brown', size = 0.75) +
  geom_line(aes(date, infected_rate_lm0), color = 'brown', size = 0.25, linetype = 'dashed') +
  scale_x_date(breaks = pretty_breaks(10)) +
  labs(x = '', y = '%') +
  ggtitle('Относительный прирост инфицированных') +
  theme(plot.title = element_text(hjust = 0.5))
```

# Выздоровевшие

```{r charts_recovered_growth,fig.align='center',dev='cairo_pdf'}
ggplot(df0) +
  geom_col(aes(date, recovered_growth), size = 0.75) +
  geom_point(aes(date, recovered_growth), color = 'brown', size = 0.75) +
  geom_line(aes(date, recovered_growth_lm0), color = 'brown', size = 0.25, linetype = 'dashed') +
  scale_x_date(breaks = pretty_breaks(10)) +
  labs(x = '', y = '') +
  ggtitle('Ежедневный прирост выздоровевших') +
  theme(plot.title = element_text(hjust = 0.5))
```

```{r charts_recovered,fig.align='center',dev='cairo_pdf'}
ggplot(df0) +
  geom_col(aes(date, recovered), size = 0.75) +
  geom_point(aes(date, recovered), color = 'brown', size = 0.75) +
  geom_line(aes(date, recovered_lm0), color = 'brown', size = 0.25, linetype = 'dashed') +
  scale_x_date(breaks = pretty_breaks(10)) +
  labs(x = '', y = '') +
  ggtitle('Общее число выздоровевших') +
  theme(plot.title = element_text(hjust = 0.5))
```

# Погибшие

```{r charts_deceased,fig.align='center',dev='cairo_pdf'}
ggplot(df0) +
  geom_col(aes(date, deceased_growth), size = 0.75) +
  geom_point(aes(date, deceased_growth), color = 'brown', size = 0.75) +
  geom_line(aes(date, deceased_growth_lm0), color = 'brown', size = 0.25, linetype = 'dashed') +
  scale_x_date(breaks = pretty_breaks(10)) +
  labs(x = '', y = '') +
  ggtitle('Ежедневный прирост погибших') +
  theme(plot.title = element_text(hjust = 0.5))

ggplot(df0) +
  geom_col(aes(date, deceased), size = 0.75) +
  geom_point(aes(date, deceased), color = 'brown', size = 0.75) +
  geom_line(aes(date, deceased_lm0), color = 'brown', size = 0.25, linetype = 'dashed') +
  scale_x_date(breaks = pretty_breaks(10)) +
  labs(x = '', y = '') +
  ggtitle('Общее число погибших') +
  theme(plot.title = element_text(hjust = 0.5))
```

# Соотношения

```{r charts_cfr,fig.align='center',dev='cairo_pdf'}
ggplot(df0, aes(date, cfr)) +
  geom_point(size = 0.75) +
  geom_line(size = 0.25, linetype = 'dashed') +
  scale_x_date(breaks = pretty_breaks(10)) +
  labs(x = '', y = '%') +
  ggtitle('CFR (T = 14 дней)') +
  theme(plot.title = element_text(hjust = 0.5))
```

# Данные

```{r table_data}
kable(df0_data, 
      caption = 'Официальные данные - Оперштаб Москвы',
      col.names = c('Дата',
                    'Инфицир.',
                    'Изм. инфицир.',
                    'Выздоров.',
                    'Изм. выздоров.',
                    'Погибш.',
                    'Изм. погибш.')
      )
```

# Модель

```{r table_model}
kable(df0_model, 
      caption = 'Прогноз по линейной модели (log2)',
      col.names = c('Дата',
                    'Инфицир.',
                    'Инфицир. ош., %',
                    'Выздоров.',
                    'Выздоров. ош., %',
                    'Погибш.',
                    'Погибш. ош., %'))
```

# Ссылки

```{r copyright,comment=''}
cat('https://t.me/COVID2019_official')
cat('https://github.com/timothy-makarov/COVID-19')
cat(paste0('(c) ', Sys.Date()))
```

